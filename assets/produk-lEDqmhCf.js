/* empty css              */(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))a(o);new MutationObserver(o=>{for(const c of o)if(c.type==="childList")for(const s of c.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&a(s)}).observe(document,{childList:!0,subtree:!0});function t(o){const c={};return o.integrity&&(c.integrity=o.integrity),o.referrerPolicy&&(c.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?c.credentials="include":o.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function a(o){if(o.ep)return;o.ep=!0;const c=t(o);fetch(o.href,c)}})();const k={};let i=[],l;const r=[];document.addEventListener("DOMContentLoaded",function(){if(console.log("DOM siap!"),document.querySelectorAll('a[href^="#"]').forEach(n=>{n.addEventListener("click",function(t){const a=this.getAttribute("href");a&&a.length>1&&document.querySelector(a)&&(t.preventDefault(),document.querySelector(a).scrollIntoView({behavior:"smooth"}))})}),document.getElementById("product-container")){v();const n=document.getElementById("categoryFilter"),t=document.getElementById("sortSelect");n&&n.addEventListener("change",y),t&&t.addEventListener("change",y)}const e=document.getElementById("hero");e&&window.addEventListener("scroll",function(){const n=window.pageYOffset;e.style.backgroundPositionY=n*.7+"px"})});async function v(){const e=document.getElementById("product-container");if(!e)return;let n;const t="https://gs7wtjsz-8090.asse.devtunnels.ms/";try{n=new PocketBase(t),await n.health.check(),l=n,console.log("Berhasil terhubung ke Pocketbase:",t)}catch(a){console.warn("Gagal terhubung ke Pocketbase di",t,". Menggunakan data dummy.",a),g();return}try{const a=await n.collection("products").getFullList({sort:"-created"});if(console.log("Produk diterima:",a),a.length===0){e.innerHTML='<p class="text-center col-12">Belum ada produk yang tersedia.</p>';return}i=a.map(o=>{const c=o.image?n.files.getUrl(o,o.image):"https://via.placeholder.com/300x200.png?text=No+Image";return{id:o.id,name:o.name||"Nama Produk Tidak Tersedia",description:o.description||"Deskripsi tidak tersedia.",image:c,category:o.category||"Umum",price:o.price||0,stock:o.stock}}),u(i)}catch(a){console.error("Error fetching products from Pocketbase:",a),e.innerHTML='<p class="text-center col-12">Gagal memuat produk. Silakan coba lagi nanti.</p>',console.warn("Menggunakan data dummy karena gagal mengambil dari Pocketbase."),g()}}function g(e){console.log("Menampilkan produk dummy..."),i=[{id:"dummy1",name:"Kue Lapis Legit (Dummy)",description:"Kue lapis klasik dengan rasa manis legit yang khas.",image_url:"https://via.placeholder.com/300x200.png?text=Kue+Lapis",category:"Non Gorengan",price:15e4,stock:15},{id:"dummy2",name:"Risoles Ragout (Dummy)",description:"Risoles gurih dengan isian ragout ayam dan sayuran.",image_url:"https://via.placeholder.com/300x200.png?text=Risoles",category:"Gorengan",price:5e3,stock:50},{id:"dummy3",name:"Bolu Kukus Pelangi (Dummy)",description:"Bolu kukus lembut dengan warna-warni menarik.",image_url:"https://via.placeholder.com/300x200.png?text=Bolu+Kukus",category:"Non Gorengan",price:3e3,stock:30},{id:"dummy4",name:"Pastel Isi (Dummy)",description:"Pastel renyah dengan isian bihun dan sayuran, cocok untuk camilan.",image_url:"https://via.placeholder.com/300x200.png?text=Pastel",category:"Gorengan",price:4e3,stock:40}].map(t=>({id:t.id,name:t.name,description:t.description,image:t.image_url,category:t.category,price:t.price,stock:t.stock})),u(i)}function u(e){const n=document.getElementById("product-container");n&&(n.innerHTML="",e.forEach((t,a)=>{k[t.id]={name:t.name,description:t.description,image:t.image};const o=`
            <div class="col">
                <div class="card product-card h-100" data-id="${t.id}" style="animation-delay: ${a*.1}s">
                    <img src="${t.image}" class="card-img-top" alt="${t.name}">
                    <div class="card-body d-flex flex-column">
                        <h5 class="card-title">${t.name}</h5>
                        <p class="card-text flex-grow-1">${t.description}</p>
                        <div class="d-flex justify-content-between align-items-center mb-2">
                            <span class="badge bg-primary">${t.category}</span>
                            <span class="price">Rp ${t.price.toLocaleString("id-ID")}</span>
                        </div>
                        <p class="card-text"><small class="text-muted">Stok: ${t.stock}</small></p>
                        <div class="input-group input-group-sm mb-2 qty-control" data-id="${t.id}">
                            <button class="btn btn-outline-secondary qty-dec" data-id="${t.id}">-</button>
                            <input type="number" min="1" value="1" class="form-control text-center qty-input-card" data-id="${t.id}">
                            <button class="btn btn-outline-secondary qty-inc" data-id="${t.id}">+</button>
                        </div>
                        <button class="btn btn-primary add-cart-btn mt-auto" data-id="${t.id}">Tambah ke Keranjang</button>
                    </div>
                </div>
            </div>`;n.innerHTML+=o}),E(),I())}function y(){const e=document.getElementById("categoryFilter"),n=document.getElementById("sortSelect");let t=[...i];if(e&&e.value!=="all"){const a=e.value.trim().toLowerCase();t=t.filter(o=>o.category.trim().toLowerCase()===a)}n&&(n.value==="price"?t.sort((a,o)=>a.price-o.price):n.value==="-price"?t.sort((a,o)=>o.price-a.price):n.value==="name"&&t.sort((a,o)=>a.name.localeCompare(o.name))),u(t)}function E(){document.querySelectorAll(".product-card").forEach(e=>{e.addEventListener("click",function(n){if(n.target.closest(".qty-control")||n.target.closest(".add-cart-btn"))return;const t=this.dataset.id,a=k[t];a&&B(a)})}),document.querySelectorAll(".add-cart-btn, .qty-control *").forEach(e=>{e.addEventListener("click",n=>n.stopPropagation())})}function B(e){const n=document.getElementById("modalProductImage"),t=document.getElementById("modalProductName"),a=document.getElementById("modalProductDescription"),o=document.getElementById("waOrderButton");if(n&&(n.src=e.image,n.alt=e.name),t&&(t.textContent=e.name),a&&(a.textContent=e.description),o){const s=encodeURIComponent(`Hai, aku mengunjungi website kalian dan tertarik pada produk ${e.name}`);o.href=`https://wa.me/6281289839168?text=${s}`,o.textContent="pesan sekarang, melalui whatsapp"}const c=document.getElementById("productModal");c&&new bootstrap.Modal(c).show()}function I(){document.querySelectorAll(".add-cart-btn").forEach(e=>{e.addEventListener("click",()=>{const n=e.dataset.id,t=document.querySelector(`.qty-input-card[data-id="${n}"]`),a=t&&parseInt(t.value,10)||1;L(n,a)})}),document.querySelectorAll(".qty-inc").forEach(e=>{e.addEventListener("click",()=>h(e.dataset.id,1))}),document.querySelectorAll(".qty-dec").forEach(e=>{e.addEventListener("click",()=>h(e.dataset.id,-1))}),document.querySelectorAll(".qty-input-card").forEach(e=>{e.addEventListener("change",()=>C(e.dataset.id,parseInt(e.value,10)))})}function L(e,n=1){const t=i.find(o=>o.id===e);if(!t)return;if(t.stock<=0){alert("Stok produk habis");return}n=Math.min(n,t.stock);const a=r.find(o=>o.id===e);if(a)if(a.qty+n<=t.stock)a.qty+=n;else{alert("Jumlah melebihi stok yang tersedia");return}else r.push({id:t.id,name:t.name,price:t.price,qty:n});m()}function p(){return r.reduce((e,n)=>e+n.price*n.qty,0)}function m(){const e=document.getElementById("cartItems"),n=document.getElementById("cartTotal");!e||!n||(e.innerHTML="",r.forEach(t=>{const a=document.createElement("li");a.innerHTML=`
            <div class="d-flex justify-content-between align-items-center mb-2">
                <span>${t.name}</span>
                <div class="input-group input-group-sm" style="width: 110px;">
                    <button class="btn btn-outline-secondary btn-dec" data-id="${t.id}">-</button>
                    <input type="number" min="1" class="form-control text-center qty-input" data-id="${t.id}" value="${t.qty}">
                    <button class="btn btn-outline-secondary btn-inc" data-id="${t.id}">+</button>
                </div>
            </div>
            <small>Rp ${t.price.toLocaleString("id-ID")}</small>`,e.appendChild(a)}),n.textContent=`Total: Rp ${p().toLocaleString("id-ID")}`,x())}function x(){document.querySelectorAll(".btn-inc").forEach(e=>{e.onclick=()=>b(e.dataset.id,1)}),document.querySelectorAll(".btn-dec").forEach(e=>{e.onclick=()=>b(e.dataset.id,-1)}),document.querySelectorAll(".qty-input").forEach(e=>{e.onchange=()=>w(e.dataset.id,parseInt(e.value,10))})}function b(e,n){const t=r.find(c=>c.id===e);if(!t)return;const a=i.find(c=>c.id===e),o=a?a.stock:1/0;t.qty=Math.min(Math.max(1,t.qty+n),o),m()}function w(e,n){const t=r.find(c=>c.id===e);if(!t)return;const a=i.find(c=>c.id===e),o=a?a.stock:1/0;(isNaN(n)||n<1)&&(n=1),t.qty=Math.min(n,o),m()}function h(e,n){const t=document.querySelector(`.qty-input-card[data-id="${e}"]`);if(!t)return;const a=i.find(s=>s.id===e),o=a?a.stock:1/0;let c=parseInt(t.value,10)||1;c=Math.min(Math.max(1,c+n),o),t.value=c}function C(e,n){const t=document.querySelector(`.qty-input-card[data-id="${e}"]`);if(!t)return;const a=i.find(c=>c.id===e),o=a?a.stock:1/0;(isNaN(n)||n<1)&&(n=1),t.value=Math.min(n,o)}function f(){const e=document.getElementById("cartContent");e&&(e.innerHTML=`
        <button type="button" class="btn-close position-absolute top-0 end-0 m-2" id="closeCartXButton" aria-label="Close"></button>
        <h5 class="mb-3">Keranjang</h5>
        <ul id="cartItems" class="list-unstyled"></ul>
        <div id="cartTotal" class="fw-bold mb-3"></div>
        <button id="checkoutButton" class="btn btn-success mb-2">Checkout</button>
        <button id="closeCartButton" class="btn btn-secondary">Tutup</button>
    `,document.getElementById("checkoutButton").addEventListener("click",q),document.getElementById("closeCartButton").addEventListener("click",d),document.getElementById("closeCartXButton").addEventListener("click",d),m())}function P(){f(),document.getElementById("cartOverlay").classList.remove("d-none")}function d(){document.getElementById("cartOverlay").classList.add("d-none")}function q(){const e=document.getElementById("cartContent"),n=p();e&&(e.innerHTML=`
        <button type="button" class="btn-close position-absolute top-0 end-0 m-2" id="closeCartXButton" aria-label="Close"></button>
        <form id="checkoutForm">
            <div class="mb-3">
                <label class="form-label">Nama</label>
                <input type="text" class="form-control" id="checkoutName" required>
            </div>
            <div class="mb-3">
                <label class="form-label">Alamat</label>
                <textarea class="form-control" id="checkoutAddress" required></textarea>
            </div>
            <div class="mb-3">
                <label class="form-label">No HP</label>
                <input type="text" class="form-control" id="checkoutPhone" required>
            </div>
            <div class="mb-3">
                <label class="form-label">Total Harga</label>
                <input type="text" class="form-control" id="checkoutTotal" readonly value="Rp ${n.toLocaleString("id-ID")}">
            </div>
            <div class="d-flex justify-content-between">
                <button type="button" class="btn btn-secondary" id="backToCartButton">Kembali</button>
                <button type="submit" class="btn btn-success">Kirim Pesanan</button>
            </div>
        </form>`,document.getElementById("checkoutForm").addEventListener("submit",S),document.getElementById("backToCartButton").addEventListener("click",f),document.getElementById("closeCartXButton").addEventListener("click",d))}async function S(e){if(e.preventDefault(),!l)try{l=new PocketBase("http://127.0.0.1:8090"),await l.health.check()}catch{alert("Gagal terhubung ke server");return}const n={name:document.getElementById("checkoutName").value,address:document.getElementById("checkoutAddress").value,phone:document.getElementById("checkoutPhone").value,total:p(),items:JSON.stringify(r)};try{await l.collection("orders").create(n);for(const t of r)try{const a=i.find(c=>c.id===t.id);if(!a)continue;const o=Math.max(0,a.stock-t.qty);await l.collection("products").update(t.id,{stock:o}),a.stock=o}catch(a){console.error("Gagal memperbarui stok",a)}alert("Pesanan berhasil dikirim"),r.length=0,d(),f(),u(i)}catch(t){console.error(t),alert("Gagal mengirim pesanan")}}document.addEventListener("DOMContentLoaded",()=>{const e=document.getElementById("cartButton");e&&e.addEventListener("click",P)});
